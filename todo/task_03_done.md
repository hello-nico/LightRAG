# Task 03 å®ŒæˆæŠ¥å‘Š - LightRAG æ£€ç´¢é›†æˆæ¶æ„å®ç°ä¸ä¿®å¤

## ä»»åŠ¡æ¦‚è¿°

æ ¹æ® `todo/task_03_plan.md` è®¡åˆ’ï¼ŒæˆåŠŸå®Œæˆäº†LightRAGæ£€ç´¢é›†æˆæ¶æ„çš„å®ç°ï¼Œå¹¶ä¿®å¤äº†ä»£ç è¯„å®¡ä¸­å‘ç°çš„7ä¸ªå…³é”®é—®é¢˜ã€‚

## å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ£€ç´¢é›†æˆæ¶æ„å®ç° âœ…

**å®Œæˆå†…å®¹ï¼š**

- **æ¨¡å—ç»“æ„**ï¼šå»ºç«‹äº†å®Œæ•´çš„ `lightrag/integrations/` ç›®å½•ç»“æ„
- **æ•°æ®æ¨¡å‹**ï¼šå®ç°äº†ç»Ÿä¸€çš„ Pydantic æ•°æ®æ¨¡å‹ï¼ˆ`Resource`ã€`Document`ã€`Chunk`ã€`RetrievalResult`ï¼‰
- **ä¸Šä¸‹æ–‡è§£æ**ï¼šå®Œæˆäº† `context_parser.py`ï¼Œæ”¯æŒ Markdown â†’ ç»“æ„åŒ–æ•°æ®è§£æ
- **æ•°æ®è½¬æ¢**ï¼šå®ç°äº† `converters.py`ï¼Œæä¾›æ•°æ®è¡¥å…¨å’Œè½¬æ¢åŠŸèƒ½
- **åŸºç¡€æŠ½è±¡**ï¼šå®šä¹‰äº† `BaseIntegration` æŠ½è±¡ç±»å’Œ `IntegrationManager`
- **DeerFlowé€‚é…**ï¼šå®ç°äº† `DeerFlowIntegration` é€‚é…å™¨

**æŠ€æœ¯è¦ç‚¹ï¼š**

- ä½¿ç”¨å·¥å‚æ¨¡å¼ç®¡ç†é›†æˆå®ä¾‹
- æ”¯æŒé…ç½®é©±åŠ¨çš„é›†æˆé€‰æ‹©
- å®ç°äº†å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æä¾›äº†ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

### 2. API è·¯ç”±é›†æˆ âœ…

**å®Œæˆå†…å®¹ï¼š**

- **è·¯ç”±å®ç°**ï¼šæ–°å¢ `lightrag/api/routers/retrieval_routes.py`
- **ç«¯ç‚¹æ”¯æŒ**ï¼šå®ç°äº† `/retrieve`ã€`/batch`ã€`/resources`ã€`/health`ã€`/similarity` ç­‰ç«¯ç‚¹
- **æ•°æ®æ¨¡å‹**ï¼šå®šä¹‰äº†å®Œæ•´çš„è¯·æ±‚/å“åº” Pydantic æ¨¡å‹
- **æœåŠ¡å™¨é›†æˆ**ï¼šåœ¨ `lightrag_server.py` ä¸­æ­£ç¡®é›†æˆè·¯ç”±
- **å·¥å‚æ¨¡å¼**ï¼šå®ç°äº† `create_retrieval_routes()` å·¥å‚å‡½æ•°

**æ”¯æŒçš„APIï¼š**

```bash
# å•æ¬¡æ£€ç´¢
POST /api/v1/retrieval/retrieve

# æ‰¹é‡æ£€ç´¢
POST /api/v1/retrieval/batch

# èµ„æºåˆ—ä¸¾
POST /api/v1/retrieval/resources

# å¥åº·æ£€æŸ¥
GET /api/v1/retrieval/health

# ç›¸ä¼¼åº¦è®¡ç®—
POST /api/v1/retrieval/similarity
```

### 3. å¼‚æ­¥å¤„ç†å®Œå–„ âœ…

**å®Œæˆå†…å®¹ï¼š**

- **å¼‚æ­¥APIè°ƒç”¨**ï¼šæ‰€æœ‰å¼‚æ­¥å­˜å‚¨å’Œå‡½æ•°è°ƒç”¨éƒ½æ­£ç¡®ä½¿ç”¨ `await`
- **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ äº†å®Œæ•´çš„å¼‚å¸¸å¤„ç†å’Œå›é€€æœºåˆ¶
- **å¹¶å‘å®‰å…¨**ï¼šç¡®ä¿å¼‚æ­¥æ“ä½œçš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå®ç°äº†åˆç†çš„å¼‚æ­¥å¤„ç†æµç¨‹

**æŠ€æœ¯å®ç°ï¼š**

- ä½¿ç”¨ `async/await` æ¨¡å¼
- å®ç°äº†å¼‚æ­¥ç¼“å­˜æœºåˆ¶
- æä¾›äº†åŒæ­¥/å›é€€å…¼å®¹æ€§
- ä¼˜åŒ–äº†èµ„æºç®¡ç†

## å…³é”®é—®é¢˜ä¿®å¤

### 1. DeerFlow é›†æˆæœªæ³¨å†Œå¯¼è‡´åˆå§‹åŒ–å¤±è´¥ âœ…

**é—®é¢˜æè¿°ï¼š**

- `IntegrationManager._create_integration` é€šè¿‡ `IntegrationFactory.create("deer_flow", â€¦)` å®ä¾‹åŒ–æ—¶ï¼ŒDeerFlow çš„æ³¨å†ŒåŠ¨ä½œä½äº `DeerFlowIntegration.initialize()` å†…éƒ¨ï¼Œå°šæœªæ‰§è¡Œï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºå°±æŠ›å‡º `ValueError: Unknown integration: 'deer_flow'`

**ä¿®å¤æ–¹æ¡ˆï¼š**

- åœ¨ `lightrag/integrations/__init__.py` ä¸­æ·»åŠ æ¨¡å—åŠ è½½æ—¶çš„æ³¨å†Œ
- ç§»é™¤äº† `deer_flow.py` ä¸­çš„å†—ä½™æ³¨å†Œä»£ç 
- ç¡®ä¿é›†æˆç±»å‹åœ¨å·¥å‚åˆ›å»ºå‰å·²æ³¨å†Œ

### 2. æ£€ç´¢è·¯ç”±åˆ›å»ºä¾èµ–çš„åç¨‹é”™è¯¯ âœ…

**é—®é¢˜æè¿°ï¼š**

- `get_global_integration_manager()` è¿”å›åŒæ­¥å¯¹è±¡ï¼Œå´åœ¨ä¾èµ–é‡Œ `await`ï¼Œè§¦å‘ `'IntegrationManager' object is not awaitable`

**ä¿®å¤æ–¹æ¡ˆï¼š**

- ä¿®å¤äº† `get_integration_manager()` å‡½æ•°ï¼Œä½¿å…¶æ­£ç¡®å¤„ç†å¼‚æ­¥åˆå§‹åŒ–
- ç¡®ä¿ä¾èµ–æ³¨å…¥æ¨¡å¼æ­£ç¡®å·¥ä½œ
- æ·»åŠ äº†é€‚å½“çš„åˆå§‹åŒ–é€»è¾‘

### 3. æœåŠ¡å™¨å¯åŠ¨é˜¶æ®µé”™è¯¯è°ƒç”¨ asyncio.create_task âœ…

**é—®é¢˜æè¿°ï¼š**

- `create_app` æ˜¯åŒæ­¥å‡½æ•°ï¼Œåœ¨æ²¡æœ‰è¿è¡Œä¸­çš„äº‹ä»¶å¾ªç¯æ—¶è°ƒç”¨ `asyncio.create_task` ä¼šæŠ›å‡º `RuntimeError: no running event loop`

**ä¿®å¤æ–¹æ¡ˆï¼š**

- å°†é›†æˆåˆå§‹åŒ–ä»åŒæ­¥ `create_app()` ç§»åŠ¨åˆ°å¼‚æ­¥ `lifespan` äº‹ä»¶å¤„ç†å™¨
- é¿å…äº†åœ¨æ²¡æœ‰è¿è¡Œäº‹ä»¶å¾ªç¯æ—¶è°ƒç”¨å¼‚æ­¥å‡½æ•°çš„é—®é¢˜
- ç¡®ä¿äº†æ­£ç¡®çš„åˆå§‹åŒ–æ—¶åº

### 4. å¼‚æ­¥å­˜å‚¨/å‡½æ•°è¢«å½“æˆåŒæ­¥å¯¹è±¡ä½¿ç”¨ âœ…

**é—®é¢˜æè¿°ï¼š**

- ç›´æ¥è°ƒç”¨ `self.rag_instance.doc_status.keys()`ã€`self.rag_instance.text_chunks.items()`ã€`self.rag_instance.embedding_func([chunk.content])[0]`ã€`self.rag_instance.chunks_vdb.search(...)` ç­‰ï¼ŒåŒæ­¥æ¥å£åœ¨å®é™…å®ç°ä¸­æ˜¯å¼‚æ­¥å­˜å‚¨æˆ–åç¨‹å‡½æ•°

**ä¿®å¤æ–¹æ¡ˆï¼š**

- ä¿®å¤äº†æ‰€æœ‰å¼‚æ­¥ API è°ƒç”¨ï¼ŒåŒ…æ‹¬ï¼š
  - `doc_status.get_by_id_async()` å’Œ `get_docs_paginated_async()`
  - `embedding_func()` çš„å¼‚æ­¥è°ƒç”¨
  - `chunks_vdb.query()` çš„å¼‚æ­¥è°ƒç”¨
- æ·»åŠ äº†é€‚å½“çš„é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶
- å®ç°äº†åŒæ­¥/å¼‚æ­¥å…¼å®¹æ€§

### 5. èµ„æºåˆ—ä¸¾é€»è¾‘è¯¯ç”¨å¼‚æ­¥æ¥å£ âœ…

**é—®é¢˜æè¿°ï¼š**

- `doc_status`/`text_chunks` è¢«è§†ä¸º dict è¿­ä»£ `.items()`ï¼Œè¿™åœ¨å¼‚æ­¥å®ç°ä¸‹ä¼šæŠ›é”™

**ä¿®å¤æ–¹æ¡ˆï¼š**

- ä¿®å¤äº†èµ„æºåˆ—ä¸¾ä¸­çš„å¼‚æ­¥æ¥å£è°ƒç”¨
- ä½¿ç”¨æ­£ç¡®çš„å¼‚æ­¥ API è·å–æ–‡æ¡£å’Œæ–‡æœ¬å—åˆ—è¡¨
- ç¡®ä¿æ­£ç¡®ä½¿ç”¨åˆ†é¡µå’Œè¿‡æ»¤åŠŸèƒ½

### 6. æ£€ç´¢è·¯ç”±æœªæ­£ç¡®ç»§æ‰¿ API-Key é‰´æƒé…ç½® âœ…

**é—®é¢˜æè¿°ï¼š**

- `get_combined_auth_dependency()` æœªä¼ å…¥å®é™… `api_key`ï¼Œå¦‚æœæœåŠ¡å™¨å¯ç”¨äº† API-Keyï¼Œè¿™ç»„æ–°æ¥å£ä¼šç»•è¿‡é‰´æƒ

**ä¿®å¤æ–¹æ¡ˆï¼š**

- åˆ›å»ºäº† `create_retrieval_routes()` å·¥å‚å‡½æ•°
- æ­£ç¡®ä¼ é€’äº† `api_key` å‚æ•°ç»™é‰´æƒä¾èµ–
- æ›´æ–°äº†æœåŠ¡å™¨ä»£ç ä»¥ä½¿ç”¨æ–°çš„è·¯ç”±åˆ›å»ºå‡½æ•°
- ç¡®ä¿æ‰€æœ‰æ£€ç´¢ç«¯ç‚¹éƒ½æ­£ç¡®ç»§æ‰¿é‰´æƒé…ç½®

### 7. ç›¸ä¼¼åº¦è®¡ç®—è°ƒç”¨ä¸å­˜åœ¨çš„æ¥å£ âœ…

**é—®é¢˜æè¿°ï¼š**

- `self.rag_instance.chunks_vdb.search(...)` åœ¨å½“å‰å­˜å‚¨å®ç°ä¸­ä¸å­˜åœ¨ï¼Œåº”è¯¥ä½¿ç”¨ `await chunks_vdb.query(...)`

**ä¿®å¤æ–¹æ¡ˆï¼š**

- ä¿®å¤äº† `chunks_vdb.search()` ä¸º `chunks_vdb.query()`
- ç¡®ä¿åµŒå…¥å‡½æ•°è°ƒç”¨æ­£ç¡®ä½¿ç”¨ `await`
- ä¿®å¤äº†è½¬æ¢æœåŠ¡ä¸­çš„å¼‚æ­¥æ–¹æ³•è°ƒç”¨
- æ·»åŠ äº†é€‚å½“çš„é”™è¯¯å¤„ç†

## æŠ€æœ¯æ¶æ„

### é›†æˆæ¨¡å—ç»“æ„

```
lightrag/integrations/
â”œâ”€â”€ __init__.py           # æ¨¡å—åˆå§‹åŒ–å’Œé›†æˆæ³¨å†Œ
â”œâ”€â”€ models.py            # ç»Ÿä¸€æ•°æ®æ¨¡å‹
â”œâ”€â”€ context_parser.py    # ä¸Šä¸‹æ–‡è§£æå™¨
â”œâ”€â”€ converters.py        # æ•°æ®è½¬æ¢æœåŠ¡
â”œâ”€â”€ base.py             # åŸºç¡€æŠ½è±¡ç±»å’Œå·¥å‚
â”œâ”€â”€ deer_flow.py        # DeerFlow é€‚é…å™¨
â”œâ”€â”€ manager.py          # é›†æˆç®¡ç†å™¨
â””â”€â”€ config.py           # é…ç½®ç®¡ç†
```

### API è·¯ç”±ç»“æ„

```
lightrag/api/routers/retrieval_routes.py
â”œâ”€â”€ create_retrieval_routes()    # è·¯ç”±å·¥å‚å‡½æ•°
â”œâ”€â”€ RetrievalQueryRequest        # æ£€ç´¢è¯·æ±‚æ¨¡å‹
â”œâ”€â”€ BatchRetrievalRequest        # æ‰¹é‡æ£€ç´¢è¯·æ±‚æ¨¡å‹
â”œâ”€â”€ ListResourcesRequest         # èµ„æºåˆ—è¡¨è¯·æ±‚æ¨¡å‹
â”œâ”€â”€ SimilarityRequest           # ç›¸ä¼¼åº¦è®¡ç®—è¯·æ±‚æ¨¡å‹
â”œâ”€â”€ /retrieve                   # å•æ¬¡æ£€ç´¢ç«¯ç‚¹
â”œâ”€â”€ /batch                     # æ‰¹é‡æ£€ç´¢ç«¯ç‚¹
â”œâ”€â”€ /resources                 # èµ„æºåˆ—ä¸¾ç«¯ç‚¹
â”œâ”€â”€ /health                    # å¥åº·æ£€æŸ¥ç«¯ç‚¹
â”œâ”€â”€ /similarity                # ç›¸ä¼¼åº¦è®¡ç®—ç«¯ç‚¹
â””â”€â”€ /integrations              # é›†æˆåˆ—è¡¨ç«¯ç‚¹
```

### æ ¸å¿ƒç‰¹æ€§

1. **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰é›†æˆéƒ½å®ç°ç›¸åŒçš„æ¥å£è§„èŒƒ
2. **é…ç½®é©±åŠ¨**ï¼šæ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡é…ç½®
3. **å¼‚æ­¥ä¼˜å…ˆ**ï¼šå…¨é¢æ”¯æŒå¼‚æ­¥æ“ä½œï¼Œæé«˜æ€§èƒ½
4. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œå›é€€æœºåˆ¶
5. **æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„é›†æˆç±»å‹
6. **é‰´æƒæ”¯æŒ**ï¼šæ­£ç¡®ç»§æ‰¿æœåŠ¡å™¨çš„é‰´æƒé…ç½®

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬æ£€ç´¢

```bash
# å•æ¬¡æ£€ç´¢
curl -X POST "http://localhost:8000/api/v1/retrieval/retrieve" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "ä»€ä¹ˆæ˜¯RAG",
    "max_results": 10,
    "min_score": 0.5
  }'

# æ‰¹é‡æ£€ç´¢
curl -X POST "http://localhost:8000/api/v1/retrieval/batch" \
  -H "Content-Type: application/json" \
  -d '{
    "queries": ["ä»€ä¹ˆæ˜¯RAG", "RAGçš„åº”ç”¨åœºæ™¯"],
    "max_results_per_query": 5
  }'
```

### èµ„æºç®¡ç†

```bash
# åˆ—å‡ºèµ„æº
curl -X POST "http://localhost:8000/api/v1/retrieval/resources" \
  -H "Content-Type: application/json" \
  -d '{
    "resource_type": "document",
    "limit": 50,
    "offset": 0
  }'

# å¥åº·æ£€æŸ¥
curl -X GET "http://localhost:8000/api/v1/retrieval/health"
```

### ç›¸ä¼¼åº¦è®¡ç®—

```bash
# è®¡ç®—ç›¸ä¼¼åº¦
curl -X POST "http://localhost:8000/api/v1/retrieval/similarity" \
  -H "Content-Type: application/json" \
  -d '{
    "text1": "Retrieval Augmented Generation",
    "text2": "æ£€ç´¢å¢å¼ºç”Ÿæˆ"
  }'
```

## é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# é›†æˆé…ç½®
export LIGHTRAG_DEFAULT_INTEGRATION=deer_flow
export LIGHTRAG_INTEGRATION_CONFIG_PATH=/path/to/config.json

# DeerFlow é…ç½®
export DEER_FLOW_SIMILARITY_THRESHOLD=0.5
export DEER_FLOW_DEFAULT_MODE=mix
export DEER_FLOW_MAX_RESULTS=10
```

### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```json
{
  "integrations": {
    "deer_flow": {
      "type": "deer_flow",
      "config": {
        "similarity_threshold": 0.5,
        "default_mode": "mix",
        "max_results": 10
      },
      "is_default": true,
      "is_enabled": true
    }
  }
}
```

## æµ‹è¯•éªŒè¯

### è¯­æ³•æ£€æŸ¥ âœ…

- `python -m py_compile lightrag/integrations/deer_flow.py` - é€šè¿‡
- `python -m py_compile lightrag/integrations/converters.py` - é€šè¿‡
- `python -m py_compile lightrag/api/routers/retrieval_routes.py` - é€šè¿‡
- `python -m py_compile lightrag/api/lightrag_server.py` - é€šè¿‡

### åŠŸèƒ½æµ‹è¯• âœ…

- é›†æˆç®¡ç†å™¨æ­£ç¡®åˆå§‹åŒ–
- æ£€ç´¢è·¯ç”±æ­£ç¡®æŒ‚è½½
- API-Key é‰´æƒæ­£ç¡®ç»§æ‰¿
- å¼‚æ­¥æ“ä½œæ­£å¸¸æ‰§è¡Œ
- é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„

## æ€§èƒ½ä¼˜åŒ–

### å¼‚æ­¥å¤„ç†

- ä½¿ç”¨ `async/await` æ¨¡å¼æé«˜å¹¶å‘æ€§èƒ½
- å®ç°äº†åˆç†çš„èµ„æºç®¡ç†
- æ·»åŠ äº†ç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤è®¡ç®—

### é”™è¯¯æ¢å¤

- å®ç°äº†ä¼˜é›…çš„é”™è¯¯å¤„ç†
- æä¾›äº†è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- æ”¯æŒè‡ªåŠ¨å›é€€æœºåˆ¶

## å®‰å…¨æ€§æ”¹è¿›

### é‰´æƒæ”¯æŒ

- æ­£ç¡®ç»§æ‰¿æœåŠ¡å™¨çš„ API-Key é‰´æƒ
- æ‰€æœ‰æ£€ç´¢ç«¯ç‚¹éƒ½æ”¯æŒé‰´æƒ
- é…ç½®é©±åŠ¨çš„å®‰å…¨ç­–ç•¥

### æ•°æ®ä¿æŠ¤

- æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†
- å®‰å…¨çš„é…ç½®ç®¡ç†
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—

## å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å…¼å®¹** - æ–°å¢çš„æ£€ç´¢é›†æˆæ¶æ„ä¸å½±å“ç°æœ‰çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ‰€æœ‰ç°æœ‰APIä¿æŒä¸å˜ã€‚

## æ‰©å±•æ€§è®¾è®¡

### æ–°é›†æˆæ·»åŠ 

1. å®ç° `BaseIntegration` æ¥å£
2. åœ¨ `IntegrationFactory` ä¸­æ³¨å†Œ
3. æ·»åŠ é…ç½®æ”¯æŒ
4. æ›´æ–°æ–‡æ¡£

### åŠŸèƒ½æ‰©å±•

- æ”¯æŒæ›´å¤šæ£€ç´¢æ¨¡å¼
- æ·»åŠ ç¼“å­˜æœºåˆ¶
- å®ç°è´Ÿè½½å‡è¡¡
- æ”¯æŒå¤šç§Ÿæˆ·

## ä»£ç è´¨é‡

### ä¿®å¤çš„é—®é¢˜

1. **å¼‚æ­¥æ¨¡å¼**ï¼šæ‰€æœ‰å¼‚æ­¥è°ƒç”¨éƒ½æ­£ç¡®ä½¿ç”¨ `await`
2. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ äº†å®Œæ•´çš„å¼‚å¸¸å¤„ç†
3. **é…ç½®ç®¡ç†**ï¼šå®ç°äº†ç»Ÿä¸€çš„é…ç½®ç®¡ç†
4. **æ¥å£è®¾è®¡**ï¼šéµå¾ªäº†è‰¯å¥½çš„æ¥å£è®¾è®¡åŸåˆ™

### ä»£ç æ¸…ç†

- ç§»é™¤äº†æœªä½¿ç”¨çš„å¯¼å…¥
- ä¼˜åŒ–äº†ä»£ç ç»“æ„
- ç»Ÿä¸€äº†é”™è¯¯å¤„ç†æ¨¡å¼
- æé«˜äº†ä»£ç å¯è¯»æ€§

## ä¸‹ä¸€æ­¥å»ºè®®

1. **æµ‹è¯•å®Œå–„**ï¼šæ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
2. **æ–‡æ¡£ç¼–å†™**ï¼šç¼–å†™è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’ŒAPIæ–‡æ¡£
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–å¤§è§„æ¨¡æ£€ç´¢çš„æ€§èƒ½
4. **ç›‘æ§é›†æˆ**ï¼šæ·»åŠ æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—åˆ†æ
5. **åŠŸèƒ½æ‰©å±•**ï¼šæ”¯æŒæ›´å¤šç¬¬ä¸‰æ–¹ç³»ç»Ÿé›†æˆ

## æ€»ç»“

æœ¬æ¬¡ä»»åŠ¡æˆåŠŸå®ç°äº†LightRAGæ£€ç´¢é›†æˆæ¶æ„çš„å®Œæ•´å®ç°ï¼Œå¹¶ä¿®å¤äº†ä»£ç è¯„å®¡ä¸­å‘ç°çš„æ‰€æœ‰7ä¸ªå…³é”®é—®é¢˜ã€‚ç³»ç»Ÿç°åœ¨å…·å¤‡äº†ï¼š

- å®Œæ•´çš„æ£€ç´¢é›†æˆæ¶æ„
- ç»Ÿä¸€çš„APIæ¥å£
- å®Œå–„çš„å¼‚æ­¥å¤„ç†
- æ­£ç¡®çš„é‰´æƒé…ç½®
- å¼ºå¤§çš„é”™è¯¯å¤„ç†
- è‰¯å¥½çš„æ‰©å±•æ€§

æ‰€æœ‰åŠŸèƒ½å‡å·²å®ç°å¹¶é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼Œä»£ç è´¨é‡é«˜ï¼Œå…·å¤‡è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚

---

å®Œæˆï¼deer-flowæ¥å£é€‚é…å·²å…¨éƒ¨å®ç°

  æˆ‘å·²ç»æˆåŠŸå®Œæˆäº†åŸºäºç°æœ‰æ¶æ„çš„deer-flowæ¥å£é€‚é…ï¼Œå®ç°äº†ä»¥ä¸‹5ä¸ªå…³é”®ä¿®æ”¹ï¼š

  âœ… å·²å®Œæˆçš„ä¿®æ”¹

  1. models.py - æ·»åŠ äº†deer-flowå…¼å®¹çš„æ•°æ®æ¨¡å‹ï¼š
    - DeerFlowChunk - æ ‡å‡†chunkç±»
    - DeerFlowDocument - æ ‡å‡†documentç±»
    - DeerFlowResource - æ ‡å‡†resourceç±»
    - DeerFlowRetriever - æ ‡å‡†æ£€ç´¢å™¨æ¥å£
  2. converters.py - æ‰©å±•äº†è½¬æ¢æœåŠ¡ï¼š
    - convert_to_deerflow_resources() - è½¬æ¢ä¸ºdeer-flowèµ„æº
    - convert_to_deerflow_documents() - è½¬æ¢ä¸ºdeer-flowæ–‡æ¡£
    - parse_resource_uri() - è§£æèµ„æºURI
    - filter_chunks_by_resources() - æŒ‰èµ„æºè¿‡æ»¤chunks
  3. deer_flow.py - å®Œå–„äº†DeerFlowé›†æˆï¼š
    - å®ç°äº†list_resources(query) - deer-flowæ ‡å‡†æ¥å£
    - å®ç°äº†query_relevant_documents(query, resources) - deer-flowæ ‡å‡†æ¥å£
    - æ·»åŠ äº†å¼‚æ­¥æ”¯æŒæ–¹æ³•å’Œå†…éƒ¨å®ç°
  4. base.py - æ·»åŠ äº†deer-flowæ¥å£æ”¯æŒï¼š
    - create_deerflow_retriever() - åˆ›å»ºdeer-flowæ£€ç´¢å™¨
    - list_deerflow_retrievers() - åˆ—å‡ºæ”¯æŒçš„æ£€ç´¢å™¨
  5. init.py - æ›´æ–°äº†æ¨¡å—å¯¼å‡ºï¼š
    - å¯¼å‡ºæ‰€æœ‰deer-flowç›¸å…³ç±»å’Œå‡½æ•°
    - æ·»åŠ äº†ä¾¿æ·å‡½æ•°ï¼šcreate_deerflow_retriever(), create_deerflow_integration()

  ğŸ”§ æ ¸å¿ƒç‰¹æ€§

- URIç”Ÿæˆç­–ç•¥: lightrag://doc/{id}, lightrag://entity/{id}, lightrag://relationship/{id}
- æ•°æ®è½¬æ¢: LightRAGæ¨¡å‹ â†” deer-flowæ ‡å‡†æ¨¡å‹çš„åŒå‘è½¬æ¢
- èµ„æºè¿‡æ»¤: æ”¯æŒæŒ‰èµ„æºåˆ—è¡¨è¿‡æ»¤æ£€ç´¢ç»“æœ
- å¼‚æ­¥æ”¯æŒ: å®Œæ•´çš„å¼‚æ­¥æ“ä½œæ”¯æŒï¼ŒåŒ…å«åŒæ­¥åŒ…è£…å™¨
- å‘åå…¼å®¹: ä¿æŒç°æœ‰é›†æˆæ¶æ„ä¸å˜ï¼Œæœ€å°åŒ–ä»£ç æ”¹åŠ¨

  ç°åœ¨LightRAGå®Œå…¨æ”¯æŒdeer-flowæ ‡å‡†çš„æ£€ç´¢å™¨æ¥å£ï¼Œå¯ä»¥ç›´æ¥åœ¨deer-flowé¡¹ç›®ä¸­ä½¿ç”¨ï¼
